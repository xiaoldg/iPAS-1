# 惡意程式與防毒
```
```
# 惡意程式的種類
```
病毒、蠕蟲和木馬程式，這三者也經常在媒體報導上被彼此誤用。
惡意行動碼與追蹤 cookies 主要是在網站瀏覽過程中入侵。
攻擊工具是指後門程式、rootkits 與鍵盤側錄等，本身不造成損害，而是植入後可供駭客使用的工具。
```
# 病毒
```
病毒 (virus) 複製自己並擴散到其它的檔案、程式或電腦上。
每種病毒有自己的擴散方式，例如寄生在檔案或程式上再經由使用者下載、拷貝後感染。

NIST SP800-83 將病毒分為兩大類：
  編譯病毒 (compiled viruses) 是經過編譯的程式，可以在作業系統上直接執行。
  直譯病毒 (interpreted viruses) 則靠應用程式執行。
  兩種主要類型為巨集病毒 (macro viruses) 與指令碼病毒 (scripting viruses) 。
```
## 病毒躲避監視的手法
```
千面人 (polymorphism)
  病毒藉著與不同的金鑰加密來改變外形，以躲避防毒偵測；啟動攻擊前再自我解密。病毒的內容在變形過程中並沒有實質改變。
變體 (metamorphism)
  病毒不是靠變形來躲避監視，而是實質地改變自己的內容。例如在原始碼中加入多餘的程式或調整程式順序後重新編譯，就產生變體病毒。
隱藏 (stealth)
  病毒利用各種技巧隱藏自己，例如有的隱藏病毒可以修改作業系統顯示的檔案大小，讓人無法察覺被寄生檔案的改變。
加殼 (armoring)
  病毒使用特殊的程式碼保護自己，使防毒軟體或清毒專家更難偵測、分解與瞭解病毒碼。
通道 (tunneling)
  病毒建立通道來攔截低階的作業系統呼叫與中斷，以削弱防毒軟體的偵測功能。
```
## 早期病毒的範例
```
作業系統從位址 100 開始執行這個程式；
  第一行直接跳到 (jump) 可執行程式碼的第一個指令位址 200，開始執行這個程式。
病毒將病毒碼寫在 .com 程式後面，並將位址 100 的內容改成 “jmp 300” 跳到病毒碼的位址。
執行病毒碼的結果可能包括再去感染別的 .com 程式，或在某種條件下發動惡意攻擊。
病毒碼執行完之後，再跳回 200 執行原程式碼，避免受到注意。
```
# 蠕蟲
```
病毒需要寄居體，而蠕蟲則相當獨立；
  它可以自行存在、自行複製、自行擴散。
  因此蠕蟲可以在短時間內快速擴散，形成全球性事件。
  蠕蟲利用網路或系統的已知弱點來進行攻擊與擴散。
  
網路服務蠕蟲 (network service worms) 利用網路服務中有弱點的作業系統或應用程式進佔主機；
  再繼續掃描其它相同弱點的主機，作為攻擊目標。由於蠕蟲擴散不需要人的參與，所以擴散極快。
  
大量郵件蠕蟲 (mass mailing worms) 與郵件病毒相仿，只是蠕蟲不需要寄居在其它檔案上。
  郵件蠕蟲感染一台電腦後，繼續使用受害者的通訊錄將自己再大量的寄出。
```
# 木馬
```
木馬程式可以自行存在，但不以複製或擴散為目的。
    它看似好的程式，卻暗藏惡意。
    
偵測木馬程式有時並不容易，因為它執行起來像是一個正常的應用程式。
  此外，較新的木馬程式也會使用躲避監視的手法。
  
不同於病毒或蠕蟲只會產生破壞，木馬程式可能為攻擊者帶來利益，因此木馬攻擊似有凌駕前兩者的趨勢。

可以使用木馬程式來散播間諜軟體；也可以用木馬進行未經授權的存取。
```
# 惡意行動碼
```
網路時代開始後，大家開始撰寫跨平台行動碼 (mobile code)，在不同的作業系統、不同的瀏覽器及電子郵件閱讀器上都能順利執行。
行動碼可以從遠端系統傳來在本地執行的軟體，通常行動碼的下載不需要使用者的允許。
雖然行動碼大多是善意的，但惡意行動碼可以攻擊系統，並傳送病毒、蠕蟲及木馬。
惡意行動碼與病毒及蠕蟲等頗有不同，它不感染檔案或企圖擴散，也不利用特定的弱點。
  惡意行動碼是靠本地主機所授予行動碼的權限。
行動碼最常使用的語言是 Java, ActiveX, Java Script, VB Script 等。
2001 年造成巨大傷害的 Nimda 即是使用 Java Script 寫成的惡意程式。
  Nimda 是 admin 倒過來寫，至今作者不詳。
```
# 混合攻擊
```
混合攻擊 (blended attack) 
    一個惡意程式使用多種感染與傳輸方法
    
Nimda 惡意程式四種擴散方式
  電子郵件
      當一個主機有弱點的使用者打開了被感染的電子郵件附件，Nimda 感染主機，並找出郵件通訊錄將自己大量的寄出。
  視窗的資源分享
      Nimda 掃描設定不當檔案分享的主機，利用 NetBIOS 傳輸來感染主機上的檔案。
      當使用者執行被感染的檔案，就會啟動 Nimda。
  網站伺服器
      Nimda 掃描網站伺服器，尋找微軟 IIS 的已知弱點 
      (同一弱點在 2001 年稍早被 Code Red 蠕蟲利用，造成全球三十餘萬台電腦被感染)
      若找到弱點，就感染該伺服器及其檔案。
  網站客戶端
      如果一台有弱點的網站客戶端瀏覽了被 Nimda 感染的網站伺服器，則客戶端主機也被感染。
      
除了以上方法，混合攻擊也可以利用 IM 或 P2P 做為擴散管道。
```
# 追蹤 Cookies
```
Cookie 是特定網站在客戶端建立的一個小資料檔。
會談 cookie 是暫時的，只在一次網站拜訪中有效；
長期 cookie 則長期存在客戶端電腦中，在每次拜訪該網站時，讓網站得以識別該使用者。
然而長期 cookie 可被利用做為間諜程式，在使用者不知情下，追蹤他的瀏覽器活動。
例如一家行銷公司在許多網站上都放廣告，卻在使用者主機上都用同一個 cookie，就可以追蹤這位使用者在每個網站的行為。
```
# 攻擊工具 (I)
```
攻擊工具 (attacker tools) 主要是幫助攻擊者不經授權地存取被感染的系統。
    攻擊工具可以藉由蠕蟲或木馬等惡意程式送進系統；再被用來進行下一步的攻擊。
後門程式 (backdoor) 泛指專門聽 TCP 或 UDP 埠的惡意程式。
    後門程式通常包含客戶端與伺服器兩個部分，前者在入侵者的遠端電腦上，後者在受感染的系統內。
    兩者連線後，入侵者就可以存取受感染系統的檔案或下指令。
殭屍程式 (zombie) 是一種後門程式，植在一個系統內讓它去攻擊別的系統。
    DDoS 攻擊就是利用許多的殭屍系統同時對一個受害者發動攻擊。
```
# 攻擊工具 (II)
```
鍵盤側錄 (keylogger) 
    監視並記錄鍵盤的使用，可能包括受害者鍵入的密碼、郵件、信用卡帳號等私密訊息。
Rootkit
    是一個或一組的惡意程式可以幫助入侵者控制系統並躲避偵測，成功地植入 rootkits 可以讓入侵者擁有管理員的權限。
瀏覽器嵌入軟體 (web browser plug-in) 可被用做間諜程式；
    一旦嵌入後，可以監視使用者的瀏覽器活動，包括上過的網站與瀏覽的網頁。
攻擊者工具包 (attacker toolkits) 可以一次植入各種工具到受害者的電腦裡面，讓攻擊者立即或日後監控受害者。
攻擊者工具包裡可能有：
    封包監視器 (pocket sniffers)，
    連接埠掃描器 (port scanners)，
    弱點掃描器 (vulnerability scanners)，
    通關密碼破解器 (password crackers)，
    遠端登入程式 (remote login programs) ，
    可以發動 DoS 之類攻擊的攻擊工具 (attacks)。
```
# 網路釣魚
```
網路釣魚 (phishing) 
    是一種欺騙攻擊，它可能是一個看似有公信力的惡意網站，或是冒名的電子郵件要受害者連結到惡意網站。
```
# 惡意程式的防禦
## 安全政策
```
如果沒有惡意程式防禦的相關政策，組織就不會貫徹執行防禦措施。

外部進入組織的任何儲存媒體都要通過惡意程式掃描後才能使用。
所有電子郵件附件都要先存入本地磁碟並通過掃描後才能開啟。
禁止以電子郵件送出或接收某些種類的檔案，如 .exe 檔。
限制或禁止使用可能傳輸惡意程式的軟體，例如 P2P 或沒有公信力的 IM。
一般使用者不該有管理員的權限。
要求系統與應用軟體更新並安裝補丁。
限制使用可移除的儲存媒體，如 USB 碟；尤其在公共區域或安全區域。
指明各系統應該安裝的防禦軟體，並指導軟體的設定方式。
規定只能使用組織認可的方法與其它網路通訊。
```
## 教育訓練
```
組織的資訊安全教育訓練中，應該加強惡意程式防禦的認知，

不開啟可疑之郵件或附件，即使熟識寄件者。
不開啟某些種類的檔案 (如 .exe 與 .com 等)。
不回應要求提供財務或個人資料的電子郵件。
不點選可疑網站的彈出視窗。
不瀏覽任何可能含惡意內容的網站。
不任意關閉安全防禦機制，如防毒軟體與個人防火牆等。
一般系統操作時，不使用管理員等級之帳號。
不下載來路不明的程式。
```
# 弱點補強
## 防毒軟體
```
掃描系統最重要的部分，像是啟動檔。
注意系統上可疑的活動
    例如當系統接收或傳送電子郵件時掃描附件。
監視應用程式的行為
    例如郵件軟體、瀏覽器和 IM 等。
    在應用程式執行有風險的動作前 (例如下載行動碼)，防毒軟體應提醒使用者。
掃描檔案檢查已知病毒
    應該設定防毒軟體固定時間掃描整個硬碟，同時也要掃描其它儲存媒體。
識別惡意程式的種類
    像是病毒、蠕蟲、木馬、行動碼、鍵盤側錄等。
```
## 防毒偵測的準確性
```
防毒軟體對惡意程式的偵測方式仍是以比對特徵 (signatures) 為主；
  這種方法對識別已知惡意程式相當有效，對已知病毒的變形、變種也有很好的偵測效果。
特徵比對乃針對已知的威脅；
  要偵測全新的惡意程式則使用探索方式 (heuristic method)
  包括在程式裡搜尋可疑的邏輯順序，或是先在虛擬機器 (virtual machine) 上執行程式來檢查可疑活動。
偵測新威脅的探索方式容易造成誤殺 (false positive)，也就是把好的檔案誤判為惡意程式。
  因此，商用防毒軟體通常會讓使用者自己調節偵測的敏感度，在安全性和方便性之間做取捨。
主要的防毒軟體廠商通常在重要攻擊事件發生幾小時內，
  就要完成惡意程式分析、編寫攻擊特徵、測試之後連同說明文件下載給用戶。
```
## 間諜程式的偵測與移除
```
防毒軟體主要在處理惡意程式；
  而間諜程式偵測與移除工具則同時針對惡意程式及非惡意程式形態的間諜程式。
  
監視最有可能帶進間諜程式的應用程式，像是瀏覽器與電子郵件軟體等。
經常性的掃描檔案、記憶體與設定檔，尋找已知間諜程式。
識別幾種間諜程式類別，包括惡意行動碼、木馬程式與追蹤 cookies 等。
防止幾種間諜程式的下載方法，包括網站的彈出視窗、追蹤 cookies、瀏覽器嵌入等。
監視網路及作業系統的核心，以及啟動程式。
隔離或刪除間諜程式。
```
# 惡意程式事件的處理
```
組織本身的事件反應能力，是處理惡意程式攻擊的基礎。

負責處理惡意程式事件的人應熟悉事件反應程序及以下的知識領域：
惡意程式感染方法。
    處理惡意程式攻擊的人要清楚了解主要惡意程式種類的擴散方法。
惡意程式偵測工具。
    處理惡意程式攻擊的人需要熟悉防毒軟體、入侵防禦系統、防火牆、間諜程式偵測與移除工具等。
電腦鑑識 (computer forensics)。
    電腦鑑識是調查惡意程式攻擊所需要具備的專業。
廣泛之資訊技術。
    廣泛的知識才能讓一位資訊安全專業人士正確評估惡意程式攻擊對組織造成的衝擊，並對隔離及復原程序做精準的建議。
程式設計。
    程式設計經驗有助於分析惡意程式的行為。
```
# 惡意程式事件的徵兆
```
網路伺服器當機。
使用者在網際網路上存取主機速度變慢、系統資源被用盡、磁碟機變慢、系統啟動速度變慢等。
  (將CPU 與記憶體使用率置於桌面隨時監視是個好方法。)
防毒軟體偵測到主機被感染並發出警訊。
系統管理員看到檔案名稱出現不正常字元。
主機記錄到稽核紀錄的設定值遭到變更。
電子郵件管理員看到大量內容可疑的退回信件。
許多主機上都出現防毒軟體被關閉的現象。
網路管理員注意到不正常的網路流量。
```
## 惡意程式隔離 (I)
```
惡意程式的隔離有兩個主要部分
    阻止惡意程式的擴散
    防止它進一步地傷害系統。
    
幾乎所有惡意程式事件都需要進行隔離。

隔離方法可被分為四個類別：
    使用者參與
    自動偵測
    暫停服務
    阻止某些網路連結。
使用者參與的隔離方法
讓使用者參與是惡意程式隔離的重要部分，尤其當事件規模大的時候。
要指導使用者如何識別感染現象，如果受感染要如何求助
    例如聯絡資訊服務台，切斷網路連結或是關機。
資訊能力較強的組織 (例如資訊公司) 可以指導使用者如何處理惡意程式，
    更新防毒軟體的病毒特徵
    進行系統掃描，
    取得並執行特製的惡意程式處理工具。
雖然使用者參與有助於惡意程式事件隔離，組織不能依靠這個方法。
  不論隔離指導給的多麼清楚，很難讓使用者都瞭解並且貫徹地執行。
```
## 惡意程式隔離 (II)
### 自動偵測的隔離方法
```
防毒軟體是最適用的惡意程式偵測及隔離工具。
  當發生大規模事件而防毒軟體無法識別惡意程式時，
  就應該使用其它資訊安全工具進行隔離，
  直到防毒程式的病毒特徵檔案得以建立。
這些輔助方法包括以電子郵件伺服器與垃圾郵件過濾器來攔阻特定郵件，或是以 IDPS 過濾特定特徵的訊息。
```
### 停止服務的隔離方法
```
惡意程式通常會依靠某種網路服務來擴散，因此停止該服務可以快速隔離惡意程式。
    例如電子郵件常是傳染的媒介，關閉電子郵件伺服器是一種有效的隔離手段。
```
### 停止連線的隔離方法
```
暫時停止網路連線也是快速有效的惡意程式隔離手段。
```
## 移除惡意程式
```
組織可以先使用工具或手工識別受感染的主機，以安裝補丁等方式修補弱點，最後再以防毒軟體等工具移除感染。
如果作業系統被惡意程式做大幅變動或遭到太多惡意程式同時攻擊，就必須重建整個系統。
```
## 系統復原
```
惡意程式事件的復原工作包含兩方面
    一、恢復受感染系統的功能與資料
    二、另移除暫時隔離的措施
    
一般惡意程式事件不需要做系統復原
    例如只感染了幾個檔案，而且已被防毒軟體清除。
在處理大型惡意程式事件過程中，決定何時解除暫時隔離的措施是一個困難的決定。
```
# 事件後的檢討
```
處理重大惡意程式事件花費巨大的時間與精力，一個組織應該從過程中檢討、學習。
```
# 可能的檢討結果
```
修正資訊安全政策避免類似事件再發生。
    例如 .scr 種類的電子郵件附件造成了病毒的擴散與攻擊，就修改政策禁止同類附件進入。
改變認知教育訓練，強化使用者對事件的回報與處理能力。
重新調整作業系統及應用程式的設定，來因應安全政策的修正。
若事件發生的原因是惡意程式偵測與防禦工具不足，應該加強相關軟體的佈建。
重新調整惡意程式偵測軟體：
  增加軟體及病毒特徵碼的更新頻率。
  提高偵測準確性 – 降低誤放機率 (同時誤殺機率也相對地提高)。 
  增加監視範圍，例如監視更多傳輸協定與檔案。
  修正當偵測到惡意程式時的反應。
```
