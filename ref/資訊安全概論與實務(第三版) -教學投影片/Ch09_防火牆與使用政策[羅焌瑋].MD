
# 防火牆與使用政策
```

```

# 防火牆簡介
```
1.防火牆 (firewall) 是一個元件，能夠藉著過濾進入或流出的資訊來執行資訊安全的管理政策。
2.防火牆技術已相當成熟，它可以和其它防火牆或是入侵偵測系統 (IDS) 協調，可以檢查郵件或網站的病毒和惡意程式，
  家庭用戶也可以藉由作業系統中的個人防火牆，比較安全地連接網際網路。
```
## 防火牆簡介 (I)
```
  防火牆的功用是保護一個網點 (site)，使它在 TCP/IP 上的弱點不會遭人利用。另外它可以區隔安全性或安全需求不同的區域。
  防火牆的種類很多，從簡單地過濾 IP 封包的邊界路由器 (boundary routers)，到較複雜可以過濾資訊內容的產品，不一而足。
  防火牆的功能差別很大，即使同一類型的產品也有很大的功能與價格的落差。
    通常我們會在組織網路的邊界使用具備進出控制能力的路由器；然後在路由器的後方裝置功能較複雜的防火牆。
```
### 選擇防火牆的考慮因素
```
[1]網點的大小
[2]資訊流量的大小
[3]系統與資料的敏感性
[4]組織所需要的應用
```


## 防火牆簡介 (II)
```
一個網點架設邊界路由器，過濾的方法可能只是拒絕某些 IP 位址傳送過來的所有封包。
路由器的後方裝置防火牆，可以做封包內容的過濾。
```
## IDS 連接受保護的網路
```
為了提供安全的遠端存取，防火牆可能與 VPN 整合，使資訊流可以加密的方式上網際網路。
防火牆本身也可能是受攻擊的目標，因此要正確的設定並下載需要的補丁。
組織應該加強防禦縱深 (defense in depth)，網路可以使用多層不同形態的防火牆與其它安全系統。
```
# 防火牆與 OSI 模型
```
各類防火牆使用到以下幾層：
資料連結層 (L2) 負責乙太網路的 MAC 位址。
網路層 (L3) 負責 IP 位址。
傳輸層 (L4) 負責 TCP 的會談身分。
應用層 (L7) 負責使用者的應用如電子郵件等。
在 L2 及 L3 運作的防火牆通常不會識別任何特定使用者；
但較高級的應用代理閘道防火牆就可以進行使用者認證，並記錄特定使用者的網路活動。
```
## 封包過濾防火牆
```
最基本的防火牆是封包過濾器 (packet filter)，它可被視為一個能針對系統位址做存取控制的路由器。
單純的封包過濾器運作在 L3 (網路層)，因此存取控制是依據以下的封包資訊：
封包的來源 IP 位址，例如 192.168.1.1。
封包的目的地 IP 位址，例如 192.168.1.2。
資訊流的類型，通常是指來源與目的地系統之間的網路通訊協定，通常 L3 使用 IP 而 L2 使用 Ethernet。
可能包含一些 L4 的訊息，像是來源與目的地的連接埠。例如 HTTP 使用 TCP:80 埠。
可能包含來源與目的地路由器的介面訊息。
```
### 封包過濾防火牆的長處
```
封包過濾防火牆的長處是「速度」與「彈性」。
速度與彈性的長處讓封包過濾器很適合做為邊界路由器 (boundary router)。
封包過濾防火牆可以阻擋某些攻擊種類，尤其是在短時間湧入大量封包的 DoS；
它可以過濾一些不受歡迎的通訊協定，可以做基本的存取控制。
```
### 封包過濾防火牆的弱點
```
封包過濾防火牆沒有檢視OSI較上層的資料，所以無法避免利用應用層級弱點的攻擊。
封包過濾防火牆只檢視少量的資料，所以它記錄的資料也少，例如來源與目的地位址與資料類型等。
這種低層的防火牆通常不具備使用者認證的功能。
封包過濾防火牆很難避免 「IP 位址偽裝」之類的攻擊。
用以判斷的資料有限，當封包過濾防火牆的設定不當時，就可能造成門戶洞開的現象。
```
## 狀態檢查防火牆 (I)
```
狀態檢查防火牆 (stateful inspection firewalls) 是一個封包過濾器再加上對 L4 (傳輸層) 的瞭解。
當系統與遠端建立 TCP 會談時，會建立一個連接埠來接收遠端系統端傳回的訊息；
狀態檢查防火牆彌補這個弱點，它以一個狀態表 (state table) 追蹤那些連接埠被打開，而不是一直維持全開的狀態。
```
## 狀態檢查防火牆 (II)
```
狀態檢查防火牆會檢查狀態表
其它都沒有開。這時若有外部系統要連結不屬於以上的連接埠，就會被拒絕。
狀態檢查防火牆比單純的封包過濾要安全，因為它能靠狀態的記憶來判斷是否允許存取，而不只依據靜態的規則。
```

## 應用代理閘道防火牆
```
應用代理閘道防火牆 (application-proxy gateway firewalls) 是較先進的防火牆，
  結合了較低層級的存取控制與較高層級 (L7) 的功能。
應用代理閘道防火牆可被視為私人網路與任何其它網路的中間人
  接到外部網路的請求之後，依據一些預定的原則做判斷該轉送這個請求或是拒絕。
  代理人防火牆將所有進出的封包都做加工處理，包括隱藏IP位址。
除了依據規則做存取控制外，應用代理閘道防火牆可以要求網路使用者做身分認證
下一頁的圖形顯示一個應用代理伺服器。外部請求存取某個應用伺服器，但實際與其連接的是代理伺服器
```
## 應用代理閘道防火牆優缺點

### 應用代理閘道防火牆的長處
```
可以檢查整個網路封包，所以能留下較完整的記錄為稽核或調查之用。
由於使用到 L7 的應用層，因此可讓安全管理員對網路使用者做身分認證。
L3/L4 防火牆的身分認證則只針對 IP 位址而非真正的使用者。
因為不只檢查 L3 資料，所以「IP 位址偽裝」之類的攻擊較不易成功。
```
### 應用代理閘道防火牆的弱點：
```
檢查整個封包所花費的時間較長，代理人防火牆較不適合流量過大或要求即時性的網路。
代理伺服器需要針對應用或協定來設計，因此當新的應用或協定問世時，未必能及時在市面上找到對應的代理伺服器。
```
## 個人防火牆
```
撥接 ISP 的家庭用戶尤其缺乏防火牆保護，因為 ISP 的防火牆需要妥協於各種不同的安全政策之下，
所以保護性不足，因此家庭用戶尤其需要個人防火牆。
個人防火牆通常操作簡單、介面友善，但是防火牆該有的功能通常頗為完備。
```

# 建立防火牆環境
```
防火牆環境 (firewall environment) 是指在網路中提供或支援完整防火牆功能的一組系統與元件。
一個最簡單的防火牆環境可能只有封包過濾防火牆；
複雜一點的可能包括數個防火牆、代理伺服器與特定的網路拓墣來支援系統與安全。
```
## 建立防火牆環境四個重點：
```
[1]儘量保持簡單，符合 KISS 原則 (keep it simple and stupid)。複雜的設計及功能容易導致設定錯誤。
[2]按照元件的功能來使用元件。例如，雖然有些路由器也有封包過濾功能，但路由器的設計還是以路由為主，不應被當防火牆使用。
[3]創造防禦縱深。我們曾經一再提醒：防禦不能只有一層。
[4]留意內部的威脅。組織內員工或是已經侵入的駭客都可能發動內部攻擊，因此不能只做外部防禦，一些重要系統要加強內部的存取管制。
```
## 防火牆環境範例

### DMZ 網路
```
安全區 (de-militarization zone, DMZ) 通常是指兩個防火牆之間所夾的網路，
  這塊區域的系統或元件需要被外部或內部所存取，因此不能放在內部保護網路區。
邊界路由器過濾封包，避免 DoS 類型的攻擊，但並不做細部的封包檢查。
  放在外部 DMZ 網路的是可以讓外部較自由存取的系統與資料，例如網站及 DNS 伺服器等。
內部 DMZ 網路則在主要防火牆的後面，存放讓內部較自由存取的系統與資料。
有許多敏感的系統或資料並不希望內部人員任意存取，所以用內部防火牆隔離出內部保護網路，它可以同時防禦外部與內部的攻擊。
```
### VPN
防火牆及防火牆環境可以建構虛擬私人網路 (virtual private network, VPN)。
```
在網際網路外的使用者與  VPN 伺服器之間使用 IPSec 等加密技術築起一條安全通道，遠端使用者就像在置身於內部 DMZ 網路一樣。
VPN 伺服器最好與防火牆結合。如果VPN 伺服器置於防火牆之後，那麼通過防火牆的資訊仍為加密資訊。
```
# 防火牆安全政策
```
資訊安全政策主導組織的安全活動，
而防火牆政策則在描述如何安排及設定防火牆來實踐資訊安全政策。
如果沒有清楚的防火牆政策，管理員對防火牆的管理會無所適從，
資訊安全事件也將層出不窮。
```
## 防火牆政策
```
[1]識別必須要的網路應用。
[2]識別每個應用的安全弱點。
[3]強化這些應用的安全性所需要的成本分析。
[4]產生應用資訊流矩陣 (application traffic matrix) 顯示保護方法。
```
## 訂定防火牆規則
```
對於外部進入的封包，防火牆的預設值 (default) 應設為「除了規則允許的，其餘拒絕」；
而不是「除了規則拒絕的，其餘允許」。
```

## 防火牆規則應拒絕的種類
```
由不明外部系統所傳來的封包，目的位址是防火牆自己。
  這一類的封包常是對防火牆的探測或攻擊。
外部進入的封包，但來源位址卻標示為內部的位址。
  這種封包通常是某種欺騙的攻擊。
外部進入的 ICMP (Internet control message protocol) 
  由於 ICMP 會透露太多網路訊息，所由外部進入的 ICMP 應予阻擋。
由不明外部系統所傳來的 SNMP (simple network management protocol)。
  這種封包很可能代表外部入侵者正在探測內部網路。
往內或往外的封包有任一位址為 0.0.0.0 者。
  有的作業系統對這個位址有特殊的定義，所以常被攻擊者利用。
```
## 防火牆規則應拒絕的檔案
```
應該阻擋以下類型的檔案進入網路及系統，尤其是以電子郵件的附件形態。
```
## 防火牆的故障復原策略
```
使用網路交換器，它持續監視使用中的防火牆，一旦故障就將所有的流量導入備援防火牆。
  通常交換器可以偽裝成它後面這兩個防火牆，所以當使用中防火牆故障時，
  交換到備援系統這個動作不影響進行中的會談。
比較便宜的方法是當使用中的防火牆故障時，使用稱做「心跳 (heartbeat) 」的機制啟動備援防火牆。
  這種方法就無法避免進行中的會談會中斷。
```

# 防火牆管理
```
移除作業系統上非必要的應用程式。
強化作業系統對攻擊的防禦能力。
及時安裝作業系統的更新與補丁。
定時進行防火牆之備份 (backup)，應使用防火牆內建的機制將備份儲存在磁帶等媒體上。
防火牆要能記錄各種資訊安全活動，管理員應每天檢視記錄。
```
